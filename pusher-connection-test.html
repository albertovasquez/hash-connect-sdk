<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pusher Connection Indicator Test</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0 0 10px 0;
        }
        
        .subtitle {
            opacity: 0.9;
            margin: 0;
        }
        
        .test-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .status-demo {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .dot-connecting {
            background: #FFA500;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        .dot-connected {
            background: #4CAF50;
        }
        
        .dot-disconnected {
            background: #FF5252;
        }
        
        .dot-failed {
            background: #D32F2F;
        }
        
        .dot-reconnecting {
            background: #FF9800;
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: #1976D2;
        }
        
        .info-box p {
            margin: 5px 0;
            color: #424242;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #FF9800;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .warning-box h3 {
            margin-top: 0;
            color: #F57C00;
        }
        
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d32f2f;
        }
        
        .config-display {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        
        .log-container {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 2px solid #4CAF50;
            padding-left: 10px;
        }
        
        .log-error {
            border-left-color: #f44336;
            color: #ff8a80;
        }
        
        .log-warning {
            border-left-color: #ff9800;
            color: #ffb74d;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîå Pusher Connection Indicator Test</h1>
        <p class="subtitle">Test and visualize the new connection status indicator and reconnection logic</p>
    </div>

    <div class="test-section">
        <h2>üìä Connection Status States</h2>
        <p>These are the five possible connection states displayed in the modal:</p>
        
        <div class="status-demo">
            <div class="status-item">
                <span class="status-dot dot-connecting"></span>
                <div>
                    <strong>Connecting...</strong>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">
                        Initial connection attempt to Pusher WebSocket
                    </p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-dot dot-connected"></span>
                <div>
                    <strong>Connected</strong>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">
                        Successfully connected to Pusher - ready to receive events
                    </p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-dot dot-disconnected"></span>
                <div>
                    <strong>Disconnected</strong>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">
                        Connection lost - will attempt automatic reconnection
                    </p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-dot dot-failed"></span>
                <div>
                    <strong>Connection Failed</strong>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">
                        Connection attempt failed - retry or check configuration
                    </p>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-dot dot-reconnecting"></span>
                <div>
                    <strong>Reconnecting...</strong>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">
                        Attempting to reconnect with exponential backoff
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîß Test Hash Connect</h2>
        <p>Click the button below to open the Hash Connect modal and see the connection indicator in action:</p>
        
        <div id="hash-connect"></div>
        
        <div class="info-box">
            <h3>‚ÑπÔ∏è What to Look For:</h3>
            <p>1. Status indicator appears at the top of the modal</p>
            <p>2. Initial state shows "Connecting..." with pulsing orange dot</p>
            <p>3. Once connected, shows "Connected" with solid green dot</p>
            <p>4. All state changes are logged in the console (press F12)</p>
        </div>
        
        <div class="warning-box">
            <h3>‚ö†Ô∏è Testing Reconnection:</h3>
            <p><strong>To test automatic reconnection:</strong></p>
            <p>1. Open the modal and wait for "Connected" state</p>
            <p>2. Open Developer Tools (F12) ‚Üí Network tab</p>
            <p>3. Set "Throttling" to "Offline" to simulate disconnection</p>
            <p>4. Watch the indicator change to "Reconnecting..."</p>
            <p>5. Set "Throttling" back to "Online"</p>
            <p>6. Watch automatic reconnection succeed</p>
        </div>
    </div>

    <div class="test-section">
        <h2>‚öôÔ∏è Reconnection Configuration</h2>
        <p>The current reconnection strategy uses exponential backoff:</p>
        
        <div class="config-display">
const RECONNECT_CONFIG = {
    maxAttempts: 3,        // Maximum automatic reconnection attempts
    baseDelay: 2000,       // Base delay: 2 seconds
    maxDelay: 30000,       // Maximum delay: 30 seconds
};

// Reconnection attempts:
// Attempt 1: 2 seconds delay
// Attempt 2: 4 seconds delay
// Attempt 3: 8 seconds delay
// After 3rd failure: Shows "Connection Failed" - manual retry needed
        </div>
    </div>

    <div class="test-section">
        <h2>üß™ Simulated Connection Flow</h2>
        <p>Simulate different connection scenarios to see the indicator in action:</p>
        
        <div class="button-grid">
            <button onclick="simulateState('connecting')">
                üîÑ Simulate Connecting
            </button>
            <button onclick="simulateState('connected')">
                ‚úÖ Simulate Connected
            </button>
            <button onclick="simulateState('disconnected')">
                ‚ùå Simulate Disconnected
            </button>
            <button onclick="simulateState('failed')">
                üö´ Simulate Failed
            </button>
            <button onclick="simulateState('reconnecting')">
                üîÅ Simulate Reconnecting
            </button>
            <button onclick="simulateReconnectionFlow()">
                üé≠ Simulate Full Reconnection Flow
            </button>
        </div>
        
        <div id="simulation-log" class="log-container" style="display: none;">
            <strong>Simulation Log:</strong>
            <div id="log-entries"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù Debug Logs</h2>
        <p>Open the browser console (F12) to see detailed connection logs:</p>
        
        <div class="config-display">
// Look for these log patterns:

[Pusher] Setting up connection state monitoring...
[Pusher] Initial connection state: connecting
[Pusher] Connection state changed: connecting -> connected
[Pusher] ‚úÖ Successfully connected to Pusher

// On disconnection:
[Pusher] Connection state changed: connected -> disconnected
[Pusher] ‚ö†Ô∏è Disconnected from Pusher
[Reconnect] Attempting reconnection 1/3 in 2000ms
[Reconnect] Calculated delay for attempt 1: 2000ms
[Reconnect] Executing reconnection attempt 1

// On successful reconnection:
[Pusher] Connection state changed: disconnected -> connected
[Pusher] ‚úÖ Successfully connected to Pusher
[Reconnect] Cleared reconnection timeout
        </div>
    </div>

    <!-- Include Hash Connect SDK -->
    <script src="dist/hash-connect.js"></script>
    
    <script>
        // Simulation functions
        let logCount = 0;
        
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('simulation-log');
            const logEntries = document.getElementById('log-entries');
            
            logContainer.style.display = 'block';
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type === 'error' ? 'log-error' : type === 'warning' ? 'log-warning' : ''}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
            
            logCount++;
            if (logCount > 50) {
                logEntries.removeChild(logEntries.firstChild);
            }
        }
        
        function simulateState(state) {
            addLog(`Simulating state: ${state}`);
            
            // Note: This is just a visual simulation
            // The actual state is controlled by Pusher connection
            const statusDot = document.getElementById('hash-connect-status-dot');
            const statusText = document.getElementById('hash-connect-status-text');
            
            if (!statusDot || !statusText) {
                addLog('Modal not open - open the modal first!', 'warning');
                alert('Please open the Hash Connect modal first by clicking the "Connect with Hash Pass" button');
                return;
            }
            
            statusDot.className = '';
            
            switch(state) {
                case 'connecting':
                    statusDot.classList.add('status-connecting');
                    statusText.textContent = 'Connecting to Pusher...';
                    addLog('‚úÖ Updated indicator to: Connecting');
                    break;
                case 'connected':
                    statusDot.classList.add('status-connected');
                    statusText.textContent = 'Connected';
                    addLog('‚úÖ Updated indicator to: Connected');
                    break;
                case 'disconnected':
                    statusDot.classList.add('status-disconnected');
                    statusText.textContent = 'Disconnected';
                    addLog('‚ö†Ô∏è Updated indicator to: Disconnected', 'warning');
                    break;
                case 'failed':
                    statusDot.classList.add('status-failed');
                    statusText.textContent = 'Connection Failed';
                    addLog('‚ùå Updated indicator to: Connection Failed', 'error');
                    break;
                case 'reconnecting':
                    statusDot.classList.add('status-reconnecting');
                    statusText.textContent = 'Reconnecting...';
                    addLog('üîÑ Updated indicator to: Reconnecting', 'warning');
                    break;
            }
        }
        
        async function simulateReconnectionFlow() {
            addLog('üé¨ Starting reconnection flow simulation...');
            
            const statusDot = document.getElementById('hash-connect-status-dot');
            if (!statusDot) {
                addLog('Modal not open - open the modal first!', 'warning');
                alert('Please open the Hash Connect modal first by clicking the "Connect with Hash Pass" button');
                return;
            }
            
            // Simulate connection flow
            addLog('1Ô∏è‚É£ Initial state: Connected');
            simulateState('connected');
            
            await sleep(2000);
            addLog('2Ô∏è‚É£ Network issue detected!', 'warning');
            simulateState('disconnected');
            
            await sleep(1500);
            addLog('3Ô∏è‚É£ Attempt 1: Reconnecting (2s delay)...', 'warning');
            simulateState('reconnecting');
            
            await sleep(2000);
            addLog('4Ô∏è‚É£ Attempt 1 failed', 'error');
            simulateState('failed');
            
            await sleep(1000);
            addLog('5Ô∏è‚É£ Attempt 2: Reconnecting (4s delay)...', 'warning');
            simulateState('reconnecting');
            
            await sleep(2000);
            addLog('6Ô∏è‚É£ Attempt 2 failed', 'error');
            simulateState('failed');
            
            await sleep(1000);
            addLog('7Ô∏è‚É£ Attempt 3: Reconnecting (8s delay)...', 'warning');
            simulateState('reconnecting');
            
            await sleep(3000);
            addLog('8Ô∏è‚É£ Success! Reconnected ‚úÖ');
            simulateState('connected');
            
            addLog('‚úÖ Simulation complete!');
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Log when page loads
        console.log('%cüîå Pusher Connection Monitoring Test Page', 'font-size: 20px; color: #667eea; font-weight: bold;');
        console.log('%cTo test the connection indicator:', 'font-size: 14px; color: #666;');
        console.log('%c1. Click "Connect with Hash Pass" button', 'font-size: 12px;');
        console.log('%c2. Watch the connection indicator at the top of the modal', 'font-size: 12px;');
        console.log('%c3. Open Network tab and set throttling to "Offline" to test reconnection', 'font-size: 12px;');
        console.log('%c4. All connection state changes will be logged here', 'font-size: 12px;');
    </script>
</body>
</html>

